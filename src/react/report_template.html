<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_title }}</title>
    <link rel="stylesheet" href="{{ report_css_path }}">
</head>
<body>
    <header>
        <h1>{{ report_title }}</h1>
        <p>User Goal: {{ user_goal }}</p>
        <p>Generated: {{ timestamp }}</p>
    </header>

    <main>
        <section id="model-viewer-container">
            <!-- Three.js canvas will be inserted here by script.js -->
        </section>

        <section id="task-details-ui">
            <h2>Workflow Details</h2>
            {% for task in tasks_data %}
            <article class="task-card">
                <h3>Task: {{ task.description }} ({{ task.agent }})</h3>
                <p><strong>Objective:</strong> {{ task.objective }}</p>
                <p><strong>Status:</strong> {{ task.status }}</p>
                
                {% if task.text_outputs %}
                    <h4>Key Text Outputs:</h4>
                    {% for output in task.text_outputs %}
                        <div>
                            <h5>{{ output.title }}</h5>
                            <pre>{{ output.content }}</pre>
                        </div>
                    {% endfor %}
                {% endif %}

                {% if task.image_files %}
                    <h4>Images:</h4>
                    <div class="image-gallery">
                    {% for img in task.image_files %}
                        <figure>
                            <img src="{{ img.path }}" alt="{{ img.description }}" style="max-width: 200px; margin: 5px;">
                            <figcaption>{{ img.description }}</figcaption>
                        </figure>
                    {% endfor %}
                    </div>
                {% endif %}
                 
                {% if task.video_files %}
                    <h4>Videos:</h4>
                    {% for vid in task.video_files %}
                        <div>
                            <video controls width="320" height="240">
                                <source src="{{ vid.path }}" type="video/mp4"> <!-- Adjust type if needed -->
                                Your browser does not support the video tag.
                            </video>
                            <p>{{ vid.description }}</p>
                        </div>
                    {% endfor %}
                {% endif %}

                {% if task.model_files %}
                    {# Check if we should display the "Other Models" section and if there are any models other than the main one #}
                    {% set has_other_models_to_display = false %}
                    {% for model_file_check in task.model_files %}
                        {% if model_file_check.path != main_3d_model_path %}
                            {% set has_other_models_to_display = true %}
                        {% endif %}
                    {% endfor %}

                    {% if has_other_models_to_display %}
                    <h4>Other Models:</h4>
                     <ul>
                    {% for model_file_item in task.model_files %}
                        {% if model_file_item.path != main_3d_model_path %} {# Only list if it's not the main display model #}
                         <li><a href="{{ model_file_item.path }}" target="_blank">{{ model_file_item.description }}</a> ({{ model_file_item.path }})</li>
                        {% endif %}
                    {% endfor %}
                    </ul>
                    {% endif %}
                {% endif %}
            </article>
            {% endfor %}
        </section>
    </main>

    <footer>
        <p>Report generated by AI Workflow.</p>
    </footer>

    <script src="{{ three_js_path }}"></script>
    <script src="{{ gltf_loader_path }}"></script>
    <script src="{{ orbit_controls_path }}"></script>
    <script>
        // Pass the main 3D model path to the script
        const mainModelPath = "{{ main_3d_model_path or '' }}";
    </script>
    <script src="{{ report_script_path }}"></script>
</body>
</html>
